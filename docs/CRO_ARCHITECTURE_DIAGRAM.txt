╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                         CRO INTELLIGENCE SYSTEM - ARCHITECTURE DIAGRAM                           ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝


┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     FRONTEND / USER LAYER                                        │
│                                                                                                  │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐              │
│  │  Website   │  │  Mobile    │  │   Tablet   │  │  Desktop   │  │  Dashboard │              │
│  │   Users    │  │   Users    │  │   Users    │  │   Users    │  │    Admin   │              │
│  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘              │
│        │                │                │                │                │                      │
│        └────────────────┴────────────────┴────────────────┴────────────────┘                    │
│                                          │                                                        │
└──────────────────────────────────────────┼────────────────────────────────────────────────────┘
                                           │
                                           │ Events (impressions, conversions, engagement)
                                           │ API Requests (GET tests, POST decisions)
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      API GATEWAY LAYER                                           │
│                                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                              Express.js REST API                                          │  │
│  │                          /api/cro/* (croDashboard.js)                                     │  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │  GET  /overview              │  Overview stats and metrics                               │  │
│  │  GET  /active-tests          │  Currently running tests with real-time data              │  │
│  │  GET  /recent-winners        │  Completed tests with winning variants                    │  │
│  │  GET  /asset-performance     │  Performance analytics by asset                           │  │
│  │  GET  /recommendations       │  ML-powered recommendations                               │  │
│  │  GET  /performance-analysis  │  Multi-dimensional analytics                              │  │
│  │  POST /tests                 │  Create new A/B test                                      │  │
│  │  POST /tests/:id/end         │  Manually end test                                        │  │
│  │  POST /events                │  Track user interaction event                             │  │
│  │  POST /orchestrate           │  Trigger orchestration cycle                              │  │
│  │  POST /ml/train              │  Train ML model                                           │  │
│  │  POST /ml/predict            │  Get performance prediction                               │  │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                                        │
└──────────────────────────────────────────┼────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    CORE SERVICES LAYER                                           │
│                                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                          CRO ORCHESTRATOR (croOrchestrator.js)                            │  │
│  │                         🎯 Main Coordination & Lifecycle Management                       │  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │  • orchestrate()         → Run hourly orchestration cycle                                │  │
│  │  • startNewTest()        → Create and start A/B tests                                    │  │
│  │  • declareWinner()       → Archive test and update production                            │  │
│  │  • recordEvent()         → Store user interaction events                                 │  │
│  │  • evaluateTests()       → Check test readiness and make decisions                       │  │
│  │  • updateTraffic()       → Smart traffic allocation                                      │  │
│  └────────┬────────────────────────────┬────────────────────────────┬───────────────────────┘  │
│           │                            │                            │                           │
│           ▼                            ▼                            ▼                           │
│  ┌────────────────────┐   ┌────────────────────┐   ┌──────────────────────────────────────┐   │
│  │  DECISION ENGINE   │   │ PERFORMANCE        │   │  VARIANT GENERATOR                    │   │
│  │ decisionEngine.js  │   │ ANALYZER           │   │  variantGenerator.js                  │   │
│  │                    │   │ performanceAn...   │   │                                       │   │
│  ├────────────────────┤   ├────────────────────┤   ├──────────────────────────────────────┤   │
│  │ 📊 Statistical     │   │ 📈 Analytics       │   │ 🎲 Hypothesis Generation             │   │
│  │    Analysis        │   │    Engine          │   │                                       │   │
│  ├────────────────────┤   ├────────────────────┤   ├──────────────────────────────────────┤   │
│  │ • evaluateTests()  │   │ • analyzeComp...() │   │ • generateTestHypotheses()           │   │
│  │ • chiSquareTest()  │   │ • analyzeByVa...() │   │ • generateHeroVariants()             │   │
│  │ • makeDecision()   │   │ • analyzeByDe...() │   │ • generateCTAVariants()              │   │
│  │ • calcConfidence() │   │ • analyzeByGeo...()│   │ • generateGalleryVariants()          │   │
│  │ • calcSampleSize() │   │ • analyzeByTi...() │   │ • prioritizeHypotheses()             │   │
│  │ • trafficAlloc...()│   │ • engagement...()  │   │ • analyzeImageCharac...()            │   │
│  │                    │   │ • timeToConv...()  │   │ • generateChallenger()               │   │
│  │ Statistics:        │   │                    │   │                                       │   │
│  │ • Chi-square p<.05 │   │ Dimensions:        │   │ Test Types:                          │   │
│  │ • 95% confidence   │   │ • By variant       │   │ • Hero image vs video                │   │
│  │ • 10% effect size  │   │ • By device        │   │ • Video length                       │   │
│  │ • Min 100 samples  │   │ • By geography     │   │ • CTA variations                     │   │
│  │                    │   │ • By event type    │   │ • Gallery order                      │   │
│  │                    │   │ • By time          │   │ • Layout changes                     │   │
│  └────────────────────┘   └────────────────────┘   └──────────────────────────────────────┘   │
│                                                                                                  │
└──────────────────────────────────────────┬───────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                 MACHINE LEARNING LAYER                                           │
│                                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                       PREDICTION MODEL (predictionModel.js)                               │  │
│  │                        🤖 ML-Powered Insights & Recommendations                           │  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │  • train()                    → Train on historical test data                            │  │
│  │  • predict()                  → Predict variant performance                              │  │
│  │  • getContentRecommendations()→ Generate content suggestions                             │  │
│  │  • buildDecisionRules()       → Learn patterns from winners                              │  │
│  │  • calculateFeatureImportance()→ Rank feature impact                                     │  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │  Features Analyzed:                    Decision Rules:                                   │  │
│  │  • Image aspect ratio                  • "Short videos (<20s) convert 15% better"        │  │
│  │  • Video duration                      • "Wedding content performs best"                 │  │
│  │  • Event type (wedding/party)          • "Mobile users convert better"                   │  │
│  │  • Device type                         • "Evening traffic converts 20% higher"           │  │
│  │  • Time of day                                                                            │  │
│  │  • Day of week                         Model Type: Decision Tree / Rule-Based            │  │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                  │
└──────────────────────────────────────────┬───────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     DATA STORAGE LAYER                                           │
│                                                                                                  │
│  ┌────────────────────────┬────────────────────────┬──────────────────────────────────────┐   │
│  │  active-tests.json     │  test-archive.json     │  test-events.json                     │   │
│  │  Currently running     │  Completed tests       │  User interaction events              │   │
│  │  tests                 │  with winners          │  (last 10,000)                        │   │
│  └────────────────────────┴────────────────────────┴──────────────────────────────────────┘   │
│                                                                                                  │
│  ┌────────────────────────┬────────────────────────┬──────────────────────────────────────┐   │
│  │  production-varia...   │  recommendations.json  │  model-data.json                      │   │
│  │  Live variant          │  Pending manual        │  Trained ML model                     │   │
│  │  configurations        │  decisions             │  and rules                            │   │
│  └────────────────────────┴────────────────────────┴──────────────────────────────────────┘   │
│                                                                                                  │
│  Storage Type: JSON Files (upgradeable to PostgreSQL for scale)                                │
│  Location: /srv/apps/mr-djv1/data/cro/                                                         │
│                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    AUTOMATION LAYER                                              │
│                                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                  CRON JOBS (setup-cron.sh)                                │  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │  ⏰ Hourly (0 * * * *)          → Run orchestration cycle                                │  │
│  │     ├─ Evaluate tests                                                                     │  │
│  │     ├─ Make statistical decisions                                                         │  │
│  │     ├─ Declare winners                                                                    │  │
│  │     └─ Start new tests                                                                    │  │
│  │                                                                                            │  │
│  │  📊 Weekly (0 9 * * 1)          → Generate performance report                            │  │
│  │     ├─ System overview                                                                    │  │
│  │     ├─ Recent winners                                                                     │  │
│  │     ├─ Asset performance                                                                  │  │
│  │     └─ ML recommendations                                                                 │  │
│  │                                                                                            │  │
│  │  🤖 Daily (0 2 * * *)           → Train ML model                                         │  │
│  │     ├─ Load historical data                                                               │  │
│  │     ├─ Build decision rules                                                               │  │
│  │     └─ Update predictions                                                                 │  │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   REPORTING LAYER                                                │
│                                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                         REPORT GENERATOR (generate-report.sh)                             │  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │  Generates weekly reports in 3 formats:                                                  │  │
│  │  • Text  (.txt)  → Console-friendly                                                      │  │
│  │  • HTML  (.html) → Web browser view                                                      │  │
│  │  • JSON  (.json) → Programmatic access                                                   │  │
│  │                                                                                            │  │
│  │  Report Contents:                                                                         │  │
│  │  ✓ System overview (active/completed tests)                                              │  │
│  │  ✓ Recent winners with improvement %                                                     │  │
│  │  ✓ Key metrics (conversion rates, impressions)                                           │  │
│  │  ✓ ML recommendations for content                                                        │  │
│  │  ✓ Asset performance rankings                                                            │  │
│  │  ✓ Action items and next steps                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                  │
│  Output: /srv/apps/mr-djv1/reports/cro/cro-report-YYYY-MM-DD.*                                 │
│                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                      DATA FLOW DIAGRAM                                            ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝

  USER INTERACTION                 EVENT TRACKING              ORCHESTRATION
        │                                │                            │
        │  1. Page View               │                            │
        ├──────────────────────────▶│                            │
        │                                │                            │
        │  2. Track Impression        │                            │
        │     (POST /api/cro/events)  │                            │
        ├────────────────────────────▶│                            │
        │                                │  3. Store Event          │
        │                                ├──────────────────────▶│
        │                                │                            │
        │  4. User Engages (video)    │                            │
        ├────────────────────────────▶│                            │
        │                                │  5. Track Engagement     │
        │                                ├──────────────────────▶│
        │                                │                            │
        │  6. User Converts (form)    │                            │
        ├────────────────────────────▶│                            │
        │                                │  7. Track Conversion     │
        │                                ├──────────────────────▶│
                                         │                            │
                                         │                            │ ⏰ HOURLY
                                         │                            │
                                         │                            │ 8. Orchestration Cycle
                                         │                            ├─────────────────┐
                                         │                            │                 │
                                         │                            │ 9. Load Events  │
                                         │                            │◀────────────────┘
                                         │                            │
                                         │                            │ 10. Calculate Metrics
                                         │                            ├─────────────────┐
                                         │                            │                 │
                                         │                            │ • Impressions   │
                                         │                            │ • Conversions   │
                                         │                            │ • Engagement    │
                                         │                            │◀────────────────┘
                                         │                            │
                                         │                            │ 11. Statistical Analysis
                                         │                            ├─────────────────┐
                                         │                            │                 │
                                         │                            │ • Chi-square    │
                                         │                            │ • Confidence    │
                                         │                            │ • Effect size   │
                                         │                            │◀────────────────┘
                                         │                            │
                                         │                            │ 12. Decision
                                         │                            ├─────────────────┐
                                         │                            │                 │
                                         │                            │ Winner Found?   │
                                         │                            │   YES           │
                                         │                            │    ↓            │
                                         │                            │ 13. Deploy      │
                                         │                            │ 14. Archive     │
                                         │                            │ 15. New Test    │
                                         │                            │◀────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                 CONFIGURATION & SETTINGS                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝

  File: /srv/apps/mr-djv1/config/cro-config.json

  AUTOMATION SETTINGS:
  ├─ enabled: true                       → Master automation switch
  ├─ min_sample_size: 100                → Min impressions per variant
  ├─ confidence_level: 0.95              → 95% statistical confidence
  ├─ max_concurrent_tests: 5             → Max simultaneous tests
  ├─ test_duration_max_days: 14          → Force decision after 14 days
  ├─ min_conversion_difference: 0.10     → 10% minimum improvement
  ├─ auto_declare_winners: true          → Auto-deploy winners
  └─ auto_start_new_tests: true          → Auto-start new tests

  OPTIMIZATION GOALS (with weights):
  ├─ contact_form_submit: 100            → Primary conversion
  ├─ phone_click: 80                     → High-intent action
  ├─ whatsapp_click: 75                  → High-intent action
  ├─ video_complete: 30                  → Strong engagement
  ├─ video_play: 20                      → Engagement
  ├─ gallery_interaction: 15             → Engagement
  ├─ time_on_page_60s: 12                → Engagement
  └─ scroll_depth_75: 10                 → Engagement

  SMART TRAFFIC ALLOCATION:
  ├─ enabled: true                       → Enable smart allocation
  └─ min_traffic_to_loser: 10           → Min 10% to losing variant

  REPORTING:
  ├─ weekly_report: true                 → Enable weekly reports
  ├─ report_day: "monday"                → Report day
  ├─ report_time: "09:00"                → Report time
  └─ notification_channels: [email, slack]


╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                      KEY METRICS                                                  ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝

  STATISTICAL THRESHOLDS:
  ├─ Significance Level (α): 0.05        → 5% false positive rate
  ├─ Confidence Level: 95%               → 95% confidence in results
  ├─ Minimum Effect Size: 10%            → At least 10% improvement
  ├─ Minimum Sample Size: 100            → Per variant
  └─ Statistical Power: 80%              → 80% chance of detecting effect

  PERFORMANCE METRICS:
  ├─ Conversion Rate                     → Conversions / Impressions
  ├─ Engagement Score                    → Weighted sum of goals
  ├─ Time to Conversion                  → Minutes until conversion
  ├─ Device Performance                  → Mobile vs Tablet vs Desktop
  ├─ Geographic Performance              → By city
  └─ Temporal Performance                → By time/day

  ML MODEL METRICS:
  ├─ Feature Importance                  → % impact of each feature
  ├─ Prediction Confidence               → % confidence in prediction
  ├─ Rule Strength                       → Support for each rule
  └─ Model Accuracy                      → Historical prediction accuracy


╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    SYSTEM CAPABILITIES                                            ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝

  ✅ Automated test creation from media assets
  ✅ Statistical decision-making (Chi-square, confidence intervals)
  ✅ Smart traffic allocation (favor winners, maintain validity)
  ✅ Multi-dimensional analytics (device, geo, time, event type)
  ✅ Machine learning predictions and recommendations
  ✅ Automated winner declaration and production deployment
  ✅ Continuous optimization (new challengers vs champions)
  ✅ Weekly performance reports (text, HTML, JSON)
  ✅ Real-time dashboard API
  ✅ Asset performance tracking and ranking
  ✅ Event tracking (impressions, conversions, engagement)
  ✅ Cron-based automation (hourly orchestration, weekly reports)


╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                     QUICK COMMANDS                                                ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝

  Initialize System:
  $ node -e "new (require('./backend/src/services/croOrchestrator'))().initialize()"

  Generate Test Data:
  $ ./scripts/cro/generate-test-data.js 3 500

  Check Status:
  $ ./scripts/cro/check-status.sh

  View Overview:
  $ curl http://localhost:3000/api/cro/overview | jq

  View Active Tests:
  $ curl http://localhost:3000/api/cro/active-tests | jq

  Manual Orchestration:
  $ curl -X POST http://localhost:3000/api/cro/orchestrate

  Generate Report:
  $ ./scripts/cro/generate-report.sh

  Setup Automation:
  $ ./scripts/cro/setup-cron.sh

  Train ML Model:
  $ curl -X POST http://localhost:3000/api/cro/ml/train


╔══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                           SYSTEM IS READY FOR DEPLOYMENT                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════╝
